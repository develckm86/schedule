<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>day-full App</title>
  <style>
    :root {
      --red-color: #ff7b7b;
      --orange-color: #ffb07b;
      --yellow-color: #fff27b;
      --green-color: #b7ff7b;
      --blue-color: #7bffbd;
      --event-height: 50px;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #1c1c1e;
      color: white;
    }

    .day-full {
      display: grid;
      grid-template-rows: auto 1fr;
      height: 100vh;
    }

    .day-full-header {
      padding: 1rem;
      background-color: #2c2c2e;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .day-full-header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .day-full-header .navigation {
      display: flex;
      gap: 1rem;
    }

    .day-full-header button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1rem;
    }

    .event-list {
      display: grid;
      grid-template-columns: 2fr 1fr;
      position: relative;
      padding: 1rem;
      background-color: #2c2c2e;
      width: 100%;
      overflow-y: auto;
    }

    #timeline {
      list-style: none;
      padding: 0;
      margin: 0;
      position: relative;
    }

    #timeline>li {
      position: relative;
      height: var(--event-height);
      border-bottom: 1px solid #444;
      box-sizing: border-box;
      display: flex;
      align-items: center;
    }
    #timeline>li>span {
      width: 70px;
      text-align: center;

    }
    .event {
      border-radius: 2px;
      padding: 0rem 1rem;
      color: black;
      box-sizing: border-box;
    }
    #timeline>.event {
      left: 70px;
      position: absolute;
      width: calc(100% - 70px);

    }

    .event-container{
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .event.red {
      background-color: var(--red-color);
    }

    .event.orange {
      background-color: var(--orange-color);
    }

    .event.yellow {
      background-color: var(--yellow-color);
    }

    .event.green {
      background-color: var(--green-color);
    }

    .event.blue {
      background-color: var(--blue-color);
    }

    .new-event-form {
      background-color: #2c2c2e;
      padding: 1rem;
      border: 1px solid #444;
      border-radius: 5px;
    }

    .new-event-form label {
      display: block;
      margin-bottom: 0.5rem;
    }

    .new-event-form input, .new-event-form select, .new-event-form button {
      width: 100%;
      box-sizing: border-box;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #444;
      border-radius: 5px;
      background-color: #1c1c1e;
      color: white;
    }

    .color-box {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }

    .color-radio {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .color-radio input[type="radio"] {
      display: none;
    }

    .color-radio label {
      cursor: pointer;
    }

    .color-radio input[type="radio"]:checked + label .color-box {
      outline: 2px solid white;
      outline-offset: 2px;
    }

    .new-event-form button {
      background-color: #5a5aed;
      cursor: pointer;
    }

  </style>
</head>
<body>
<div class="day-full">
  <div class="day-full-header">
    <h1>2024년 12월 20일</h1>
    <div class="navigation">
      <button>&lt;</button>
      <button>&gt;</button>
    </div>
  </div>
  <div class="event-list">
    <div id="events">
      <div id="allDayEvents">
        <div><span>하루 종일</span></div>
        <ul id="allDayUl"></ul>
      </div>
      <ul id="timeline">
        <li><span>00:00</span></li>
        <li><span>01:00</span></li>
        <li><span>02:00</span></li>
        <li><span>03:00</span></li>
        <li><span>04:00</span></li>
        <li><span>05:00</span></li>
        <li><span>06:00</span></li>
        <li><span>07:00</span></li>
        <li><span>08:00</span></li>
        <li><span>09:00</span></li>
        <li><span>10:00</span></li>
        <li><span>11:00</span></li>
        <li><span>12:00</span></li>
        <li><span>13:00</span></li>
        <li><span>14:00</span></li>
        <li><span>15:00</span></li>
        <li><span>16:00</span></li>
        <li><span>17:00</span></li>
        <li><span>18:00</span></li>
        <li><span>19:00</span></li>
        <li><span>20:00</span></li>
        <li><span>21:00</span></li>
        <li><span>22:00</span></li>
        <li><span>23:00</span></li>
      </ul>
    </div>
    <form class="new-event-form" id="newEventForm">
      <div class="event-container">
        <div id="eventEx" class="event red" data-time="00:00,01:00">
          <small class="time"></small>
          <div class="content">
            <span class="icon">🎉</span>
            <span class="title">새 이벤트</span>
          </div>
        </div>
        <li id="allDayEventEx" class="all-event red">
          <div class="content">
            <span class="icon">🎉</span>
            <span class="title">새 이벤트</span>
          </div>
        </li>

      </div>

      <label for="eventName">이벤트 이름</label>
      <input type="text" id="eventName" name="eventName" placeholder="이벤트 이름" value="새 이벤트">

      <label for="eventType">이벤트 유형</label>
      <select id="eventType" name="eventType">
        <option value="timed" selected>Timed</option>
        <option value="allDay">All Day</option>
      </select>

      <label for="startTime">시작 시간</label>
      <input type="time" id="startTime" name="startTime">

      <label for="endTime">종료 시간</label>
      <input type="time" id="endTime" name="endTime">

      <label>이벤트 색상
        <div id="eventColorPreview" class="color-radio">
          <input checked type="radio" id="colorRed" name="eventColor" value="red">
          <label for="colorRed">
            <div class="color-box" style="background-color: var(--red-color);"></div>
          </label>

          <input type="radio" id="colorOrange" name="eventColor" value="orange">
          <label for="colorOrange">
            <div class="color-box" style="background-color: var(--orange-color);"></div>
          </label>

          <input type="radio" id="colorYellow" name="eventColor" value="yellow">
          <label for="colorYellow">
            <div class="color-box" style="background-color: var(--yellow-color);"></div>
          </label>

          <input type="radio" id="colorGreen" name="eventColor" value="green">
          <label for="colorGreen">
            <div class="color-box" style="background-color: var(--green-color);"></div>
          </label>

          <input type="radio" id="colorBlue" name="eventColor" value="blue">
          <label for="colorBlue">
            <div class="color-box" style="background-color: var(--blue-color);"></div>
          </label>
        </div>
      </label>

      <label for="eventIcon">이벤트 아이콘</label>
      <select id="eventIcon" name="eventIcon">
        <option selected value="🎉">🎉 파티</option>
        <option value="🏥">🏥 병원</option>
        <option value="🍴">🍴 식사</option>
        <option value="💻">💻 작업</option>
        <option value="📞">📞 전화</option>
      </select>

      <button type="submit" id="addEventButton">이벤트 추가</button>
    </form></div>
</div>
<script>
  const EVENT_HEIGHT = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--event-height'));
  const eventForm = document.forms["newEventForm"];
  const eventEx = document.getElementById("eventEx");
  const timeline = document.getElementById("timeline");

  // Object to manage events
  const events = {};

  const init = function () {
    const startTime = eventForm.startTime;
    const endTime = eventForm.endTime;
    const time = eventEx.querySelector(".time");
    const now = new Date();
    const pad = (num) => num.toString().padStart(2, '0');

    const defaultStartHour = now.getHours();
    const defaultStartMinute = now.getMinutes();
    const defaultStart = `${pad(defaultStartHour)}:${pad(defaultStartMinute)}`;
    startTime.value = defaultStart;


    let defaultEndHour = defaultStartHour + 1;
    let defaultEndMinute = defaultStartMinute;

    // Correctly handle the rollover from 23 to 00
    if (defaultEndHour === 24) {
      defaultEndHour = 0;
      // Optionally increment the day (if your date picker supports it)
      // now.setDate(now.getDate() + 1) ;
    }

    const defaultEnd = `${pad(defaultEndHour)}:${pad(defaultEndMinute)}`;
    endTime.value = defaultEnd;

    eventEx.dataset.time = defaultStart + "," + defaultEnd;
    time.innerText = defaultStart + " - " + defaultEnd;
  };
  init();
  class AddEventFormData{
    constructor(form) {
      this.eventName = form.eventName.value;
      this.eventColor = form.eventColor.value;
      this.eventIcon = form.eventIcon.value;
      this.startTime = form.startTime.value;
      this.endTime = form.endTime.value;
      this.timeRange = `${this.startTime} - ${this.endTime}`;
      const [startHours, startMinutes] = this.startTime.split(":").map(Number);
      const [endHours, endMinutes] = this.endTime.split(":").map(Number);
      this.startDecimal = startHours + startMinutes / 60;
      this.endDecimal = endHours + endMinutes / 60;
    }
    getEventNode(){
      const node = eventEx.cloneNode(true);
      node.removeAttribute("id");
      const time = node.querySelector(".time");
      const title = node.querySelector(".title");
      const icon = node.querySelector(".icon");
      node.dataset.time = this.timeRange;
      node.classList.add(this.eventColor);
      node.style.top = `${this.startDecimal * EVENT_HEIGHT}px`;
      node.style.height = `${(this.endDecimal - this.startDecimal) * EVENT_HEIGHT}px`;
      title.innerText = this.eventName;
      icon.innerText = this.eventIcon;
      time.innerText = this.timeRange;

      return node;
    };
  }
  // Add new event
  eventForm.onsubmit = (e) => {
    e.preventDefault();

    const formData = new AddEventFormData(eventForm);
    console.log(formData);
    const eventNode = formData.getEventNode();

    // Check for overlapping events
    for (const [key, value] of Object.entries(events)) {
      const [existingStart, existingEnd] = key.split(" - ").map((time) => {
        const [hours, minutes] = time.split(":").map(Number);
        return hours + minutes / 60;
      });

      if (
              (formData.startDecimal < existingEnd && formData.startDecimal > existingStart) ||
              (formData.endDecimal > existingStart && formData.endDecimal < existingEnd) ||
              (formData.startDecimal <= existingStart && formData.endDecimal >= existingEnd) ||
              (formData.startDecimal >= existingStart && formData.endDecimal <= existingEnd)
      ) {
        const replace = confirm(`"${value.eventName}"와 겹칩니다. 대체하시겠습니까?`);
        if (!replace) {
          return; // Cancel adding the event
        }
        // Remove the overlapping event
        timeline.removeChild(value.node);
        delete events[key];
        break;
      }
    }

    // Add new event to the timeline and events object
    timeline.appendChild(eventNode);
    events[formData.timeRange] = { ...formData, node: eventNode };
  };



</script>
</body>
</html>
